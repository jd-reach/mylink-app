<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyLink Profile</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">

    <style>
        /* PROFILE SPECIFIC STYLES */
        
        /* Layout: Centered column like a mobile app */
        .profile-layout {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding-top: 60px;
            padding-bottom: 40px;
        }

        /* Header: Avatar, Name, Bio */
        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease;
        }

        .profile-image {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 16px;
            border: 4px solid white;
            box-shadow: var(--shadow-md);
        }

        .profile-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .verified-badge {
            color: var(--color-primary);
            font-size: 0.9em;
        }

        .profile-bio {
            font-size: 0.95rem;
            color: var(--color-text-secondary);
            max-width: 90%;
            line-height: 1.5;
        }

        /* The Links List */
        .links-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            width: 100%;
            animation: fadeInUp 0.8s ease;
        }

        /* Individual Link Pill */
        .link-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.75); /* High opacity glass */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 16px 20px;
            border-radius: 50px; /* Pill shape */
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .link-card:hover {
            transform: scale(1.02);
            background: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-color: white;
        }

        .link-card:active {
            transform: scale(0.98);
        }

        .link-content {
            display: flex;
            align-items: center;
            gap: 14px;
            flex: 1;
        }

        .link-icon {
            font-size: 1.2rem;
            color: var(--color-text-primary);
            width: 24px;
            text-align: center;
        }

        .link-text {
            font-weight: 600;
            color: var(--color-text-primary);
            font-size: 1rem;
        }

        /* Pinned Star Styling */
        .link-card.pinned {
            border: 2px solid rgba(79, 70, 229, 0.15);
        }
        
        .pinned-star {
            color: var(--color-warning);
            font-size: 0.9rem;
        }

        /* Share Button */
        .share-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.5);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-primary);
            transition: 0.2s;
        }
        .share-btn:hover { background: white; }

        /* Branding Footer */
        .mylink-footer {
            margin-top: auto;
            text-align: center;
            padding-top: 40px;
            opacity: 0.6;
            transition: 0.2s;
        }
        .mylink-footer:hover { opacity: 1; }
        .mylink-logo {
            font-weight: 700;
            color: var(--color-text-primary);
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <div id="loader" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--color-bg-body); z-index:9999; display:flex; justify-content:center; align-items:center;">
        <i class="fa-solid fa-circle-notch fa-spin" style="font-size: 2rem; color: var(--color-primary);"></i>
    </div>

    <button class="share-btn" onclick="copyLink()">
        <i class="fa-solid fa-share-nodes"></i>
    </button>

    <main class="container container-narrow profile-layout">
        
        <header class="profile-header">
            <img src="" alt="Profile" class="profile-image" id="profile-image">
            <h1 class="profile-name">
                <span id="profile-name">@username</span>
                <i class="fa-solid fa-circle-check verified-badge" title="Verified User"></i>
            </h1>
            <p class="profile-bio" id="profile-bio"></p>
        </header>

        <div class="links-container" id="links-container">
            </div>

        <footer class="mylink-footer">
            <a href="index.html" class="mylink-logo">
                <i class="fa-solid fa-link" style="color:var(--color-primary)"></i> MyLink
            </a>
        </footer>

    </main>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    
    <script>
        /* INLINE SCRIPT TO OVERRIDE RENDER LOGIC FOR NEW DESIGN */
        
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('user');

        document.addEventListener('DOMContentLoaded', () => {
            if(username) {
                loadPublicProfile(username);
            } else {
                document.getElementById('loader').classList.add('hidden');
                document.body.innerHTML = '<h3 class="text-center mt-xl">No user specified</h3>';
            }
        });

        async function loadPublicProfile(user) {
            try {
                const res = await fetch(`${CONFIG.API_URL}/users/${user}`);
                const data = await res.json();

                if (data.success) {
                    renderProfile(data.user);
                } else {
                    document.body.innerHTML = '<h3 class="text-center mt-xl">User not found</h3>';
                }
            } catch (error) {
                console.error(error);
                document.body.innerHTML = '<h3 class="text-center mt-xl">Error loading profile</h3>';
            } finally {
                document.getElementById('loader').classList.add('hidden');
            }
        }

        function renderProfile(user) {
            document.title = `${user.username} | MyLink`;
            document.getElementById('profile-name').textContent = `@${user.username}`;
            
            // Bio
            if (user.bio) {
                document.getElementById('profile-bio').innerHTML = user.bio.replace(/\n/g, '<br>');
            } else {
                document.getElementById('profile-bio').style.display = 'none';
            }

            // Image Logic
            const imgEl = document.getElementById('profile-image');
            if (user.profileImage && user.profileImage.startsWith('data:image')) {
                imgEl.src = user.profileImage;
            } else {
                // Generate colorful avatar
                imgEl.src = `https://ui-avatars.com/api/?name=${user.username}&background=4f46e5&color=fff&size=128&bold=true`;
            }

            // Links Logic
            const container = document.getElementById('links-container');
            container.innerHTML = ''; 

            if(user.links.length === 0) {
                container.innerHTML = '<p class="text-center text-xs" style="opacity:0.5;">No links public yet.</p>';
                return;
            }

            const sortedLinks = user.links.sort((a, b) => Number(b.isPinned) - Number(a.isPinned));

            sortedLinks.forEach(link => {
                const isPinnedClass = link.isPinned ? 'pinned' : '';
                const iconClass = link.icon || 'fa-solid fa-arrow-up-right-from-square'; // Default icon
                
                // New HTML Structure for Glass Pills
                const html = `
                    <a href="${link.url}" class="link-card ${isPinnedClass}" target="_blank" rel="noopener noreferrer">
                        <div class="link-content">
                            <span class="link-text">${link.title}</span>
                        </div>
                        ${link.isPinned ? '<i class="fa-solid fa-star pinned-star"></i>' : ''}
                    </a>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        }

        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                // Use our new toast utility!
                if(window.showToast) {
                    window.showToast('Link copied to clipboard!', 'success');
                } else {
                    alert('Link copied!');
                }
            });
        }
    </script>
</body>
</html>